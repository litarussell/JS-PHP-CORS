<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>ajax跨域测试</title>
	<link rel="stylesheet" href="./lib/jasmine-3.1.0/jasmine.css">
</head>
<body>

	<script type="text/javascript" src="./lib/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="./lib/jasmine-3.1.0/jasmine.js"></script>
	<script type="text/javascript" src="./lib/jasmine-3.1.0/jasmine-html.js"></script>
	<script type="text/javascript" src="./lib/jasmine-3.1.0/boot.js"></script>
	<script>
		jasmine.DEFAULT_TIMEOUT_INTERVAL = 1500;
		var cors = "http://localhost:8080/index.php?m=",
			base = "index.php?m="

		describe("lita_1",()=>{
			
			// it("带自定义头的ajax跨域请求", function(done){
			// 	var re;
			// 	$.ajax(cors+"header", {
			// 		method: "get",
			// 		dataType: "json",
			// 		headers: {
			// 			"x-A":"aaa"
			// 		},
			// 		beforeSend(xhr){
			// 			xhr.setRequestHeader("x-B", "bbb")
			// 		}
			// 	})
			// 	.then(content=>{
			// 		re = content
			// 		console.log(re)
			// 	})
			// 	setTimeout(()=>{
			// 		console.log(re)
			// 		expect(re).toEqual({
			// 			"data": "header aaa bbb"
			// 		});
			// 		done();
			// 	},1000)
			// })

			// it("带cookie的ajax跨域请求", function(done){
			// 	var re;
			// 	$.ajax(cors+"cookie", {
			// 		method: "get",
			// 		dataType: "json",
			// 		xhrFields: {
			// 	      	withCredentials: true
			// 	   	}
			// 	})
			// 	.then(content=>{
			// 		re = content
			// 		console.log(re)
			// 	})
			// 	setTimeout(()=>{
			// 		console.log(re)
			// 		expect(re).toEqual({
			// 			"data": "cookie lita"
			// 		});
			// 		done();
			// 	},1000)
			// })

			// 非简单请求跨域时会使用options方法发送预检命令
			it("ajax非简单命令请求跨域", function(done){
				var re;
				$.ajax(cors+"postjson", {
					method: "post",
					dataType: "json",
					contentType: "application/json;charset=utf-8",
					data: JSON.stringify({"name":"litao"}),
				})
				.then(content=>{
					re = content
					console.log(re)
				})
				setTimeout(()=>{
					console.log(re)
					expect(re).toEqual({
						"data": "post json litao"
					});
					done();
				},900)
			})
			
			// it("被调用方filter解决跨域请求", function(done){
			// 	var re;
			// 	$.ajax(cors+"filter", {
			// 		type: "get",
			// 		dataType: "json"
			// 	})
			// 	.then(content=>{
			// 		re = content
			// 	})
			// 	setTimeout(()=>{
			// 		console.log(re)
			// 		expect(re).toEqual({data:"被调用方 filter解决跨域"});
			// 		done();
			// 	},400)
			// })

			// it("jsonp请求", function(done){
			// 	var re;
			// 	$.ajax(cors+"jsonp", {
			// 		type: "get",
			// 		dataType: "jsonp",
			// 	})
			// 	.then(content=>{
			// 		re = content
			// 	})
			// 	setTimeout(()=>{
			// 		console.log(re)
			// 		expect(re).toEqual({data:"jsonp"});
			// 		done();
			// 	}, 400)
			// })
			
			// it("ajax非跨域请求", function(done){
			// 	var re;
			// 	$.ajax(base+"ajaxpost", {
			// 		method: "post",
			// 		dataType: "json",
			// 		contentType: "application/json",
			// 		data: JSON.stringify({"name":"litao"}),
			// 	})
			// 	.then(content=>{
			// 		re = content
			// 		console.log(re)
			// 	})
			// 	setTimeout(()=>{
			// 		console.log(re)
			// 		expect(re).toEqual({
			// 			"data": "ajax litao"
			// 		});
			// 		done();
			// 	},500)
			// })
		})
	</script>
</body>
</html>